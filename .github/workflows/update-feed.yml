name: Update Meme RSS Feed

on:
  workflow_dispatch:     # ‚Üê manual trigger
        schedule:
          - cron: "0 */4 * * *"


jobs:
  build-rss:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build RSS feed
        shell: bash
        run: |
          python3 - << 'PYCODE'
          import glob, os, time
          from xml.sax.saxutils import escape

          items = []
          for img in sorted(glob.glob("memes/*.jpg"))[-7:]:
              d = os.path.basename(img).split(".")[0]
              url = f"https://raw.githubusercontent.com/Carnage1984/auto-90s-memes/main/{img}"
              items.append(f"<item><title>90s Meme for {escape(d)}</title><link>{escape(url)}</link><pubDate>{time.strftime('%a, %d %b %Y %H:%M:%S +0000', time.gmtime())}</pubDate></item>")

          feed = "<?xml version='1.0'?><rss version='2.0'><channel>" + "".join(items) + "</channel></rss>"
          echo "$feed" > feed.xml
          PYCODE

      - name: Commit & push RSS
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "chore: test RSS feed"
          file_pattern: feed.xml
